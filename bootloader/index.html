<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="An experimental x86_64 bootloader that works on both BIOS and UEFI systems."><meta name="keywords" content="rust, rustlang, rust-lang, bootloader"><title>bootloader - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../bootloader/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class="location">Crate bootloader</p><div class="block version"><p>Version 0.10.1</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all bootloader's items</p></a><div class="block items"><ul><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li></ul></div><p class="location"></p><div id="sidebar-vars" data-name="bootloader" data-ty="mod" data-relpath="../"></div></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="">bootloader</a><button id="copy-path" onclick="copy_path(this)">⎘</button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/bootloader/lib.rs.html#1-123" title="goto source code">[src]</a></span></h1><div class="docblock"><p>An experimental x86_64 bootloader that works on both BIOS and UEFI systems.</p>
<p>To use this crate, specify it as a dependency in the <code>Cargo.toml</code> of your operating system
kernel. Then you can use the <a href="../bootloader/macro.entry_point.html" title="entry_point"><code>entry_point</code></a> macro to mark your entry point function. This
gives you access to the <a href="../bootloader/boot_info/struct.BootInfo.html" title="BootInfo"><code>BootInfo</code></a> struct, which is passed by the bootloader.</p>
<h2 id="disk-image-creation" class="section-header"><a href="#disk-image-creation">Disk Image Creation</a></h2>
<p>Including the <code>bootloader</code> crate as a dependency makes the kernel binary suitable for booting,
but does not create any bootable disk images. To create them, two additional steps are needed:</p>
<ol>
<li>
<p><strong>Locate the source code of the <code>bootloader</code> dependency</strong> on your local system. By using the
dependency source code directly, we ensure that the kernel and bootloader use the same version
of the <a href="../bootloader/boot_info/struct.BootInfo.html" title="BootInfo"><code>BootInfo</code></a> struct.</p>
<ul>
<li>When creating a builder binary written in Rust, the
<a href="https://docs.rs/bootloader-locator/0.0.4/bootloader_locator/"><code>bootloader_locator</code></a> crate can
be used to automate this step.</li>
<li>Otherwise, the
<a href="https://doc.rust-lang.org/cargo/commands/cargo-metadata.html"><code>cargo metadata</code></a> subcommand
can be used to locate the dependency. The command outputs a JSON object with various metadata
for the current package. To find the <code>bootloader</code> source path in it, first look for the
“bootloader” dependency under <code>resolve.nodes.deps</code> to find out its ID (in the <code>pkg</code> field).
Then use that ID to find the bootloader in <code>packages</code>. Its <code>manifest_path</code> field contains the
local path to the <code>Cargo.toml</code> of the bootloader.</li>
</ul>
</li>
<li>
<p><strong>Run the following command</strong> in the source code directory of the <code>bootloader</code> dependency to create
the bootable disk images:</p>
<pre><code class="language-notrust">cargo builder --kernel-manifest path/to/kernel/Cargo.toml --kernel-binary path/to/kernel_bin
</code></pre>
<p>The <code>--kernel-manifest</code> argument should point to the <code>Cargo.toml</code> of your kernel. It is used
for applying configuration settings. The <code>--kernel-binary</code> argument should point to the kernel
executable that should be used for the bootable disk images.</p>
<p>In addition to the <code>--kernel-manifest</code> and <code>--kernel-binary</code> arguments, it is recommended to also
set the <code>--target-dir</code> and <code>--out-dir</code> arguments. The former specifies the directory that should
used for cargo build artifacts and the latter specfies the directory where the resulting disk
images should be placed. It is recommended to set <code>--target-dir</code> to the <code>target</code> folder of your
kernel and <code>--out-dir</code> to the the parent folder of <code>--kernel-binary</code>.</p>
</li>
</ol>
<p>This will result in the following files, which are placed in the specified <code>--out-dir</code>:</p>
<ul>
<li>A disk image suitable for BIOS booting, named <code>boot-bios-&lt;kernel&gt;.img</code>, where <code>&lt;kernel&gt;</code> is the
name of your kernel executable. This image can be started in QEMU or booted on a real machine
after burning it to an USB stick..</li>
<li>A disk image suitable for UEFI booting, named <code>boot-uefi-&lt;kernel&gt;.img</code>. Like the BIOS disk image,
this can be started in QEMU (requires OVMF) and burned to an USB stick to run it on a real
machine.</li>
<li>Intermediate UEFI files
<ul>
<li>A FAT partition image named <code>boot-uefi-&lt;kernel&gt;.fat</code>, which can be directly started in QEMU
or written as an EFI system partition to a GPT-formatted disk.</li>
<li>An EFI file named <code>boot-uefi-&lt;kernel&gt;.efi</code>. This executable is the combination of the
bootloader and kernel executables. It can be started in QEMU or used to construct a bootable
disk image: Create an EFI system partition formatted with the FAT filesystem and place the
EFI file under <code>efi\boot\bootx64.efi</code> on that filesystem.</li>
</ul>
</li>
</ul>
<h2 id="configuration" class="section-header"><a href="#configuration">Configuration</a></h2>
<p>The bootloader can be configured through a <code>[package.metadata.bootloader]</code> table in the
<code>Cargo.toml</code> of the kernel (the one passed as <code>--kernel-manifest</code>). See the <a href="../bootloader/struct.Config.html" title="Config"><code>Config</code></a> struct
for all possible configuration options.</p>
</div><h2 id="reexports" class="section-header"><a href="#reexports">Re-exports</a></h2>
<table><tr><td><code>pub use crate::boot_info::<a class="struct" href="../bootloader/boot_info/struct.BootInfo.html" title="struct bootloader::boot_info::BootInfo">BootInfo</a>;</code></td></tr></table><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<table><tr class="module-item"><td><a class="mod" href="boot_info/index.html" title="bootloader::boot_info mod">boot_info</a></td><td class="docblock-short"><p>Contains the boot information struct sent by the bootloader to the kernel on startup.</p>
</td></tr></table><h2 id="macros" class="section-header"><a href="#macros">Macros</a></h2>
<table><tr class="module-item"><td><a class="macro" href="macro.entry_point.html" title="bootloader::entry_point macro">entry_point</a></td><td class="docblock-short"><p>Defines the entry point function.</p>
</td></tr></table><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.Config.html" title="bootloader::Config struct">Config</a></td><td class="docblock-short"><p>Allows configuring the bootloader behavior.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="bootloader" data-search-js="../search-index.js"></div>
    <script src="../main.js"></script></body></html>